<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<style>

:nth-child(1){--n:1}
:nth-child(2){--n:2}
:nth-child(3){--n:3}
:nth-child(4){--n:4}
:nth-child(5){--n:5}

:nth-child(7){--n:7}
:nth-child(8){--n:8}
:nth-child(9){--n:9}
:nth-child(10){--n:10}
:nth-child(11){--n:11}
:nth-child(12){--n:12}
:nth-child(13){--n:13}
:nth-child(14){--n:14}
:nth-child(15){--n:15}
:nth-child(16){--n:16}
:nth-child(17){--n:17}
:nth-child(18){--n:18}
:nth-child(19){--n:19}
:nth-child(20){--n:20}
:nth-child(21){--n:21}
:nth-child(22){--n:22}
:nth-child(23){--n:23}
:nth-child(24){--n:24}
:nth-child(25){--n:25}
:nth-child(26){--n:26}
:nth-child(27){--n:27}
:nth-child(28){--n:28}
:nth-child(29){--n:29}
:nth-child(30){--n:30}

    body{
        margin: 0;
        background-color: black;
    }

    .bound{
        margin: 0;
        width: calc( 99.5vw - 10vmin);
        height: calc( 99.5vh - 10vmin);
        /* margin-bottom: 10vmin; */
        /* border: solid 1px black; */
        padding-right: 10vmin;
        padding-bottom: 10vmin;
    }

    .box:nth-child(n){
        position: absolute;
        background-color: hsl(calc(   var(--n) * 360 / 30       ), 80%, 50%);
        width: 4vmin;
        height: 4vmin;
        transform:translate(45vw,45vh);
        /* border: 1px solid black; */
        border-radius: 50%;
        font-size: 4vmin;
        color: aliceblue;
        text-align: center;
        line-height: 4vmin;
        font-family: 'Courier New', Courier, monospace;
    }

    
</style>

<body>

    <div id="bound" class="bound">
        <div id="box1" class="box"></div>
        <div id="box2" class="box"></div>
        <div id="box3" class="box"></div>
        <div id="box4" class="box"></div>
        <div id="box5" class="box"></div>
        <div id="box6" class="box"></div>
        <div id="box7" class="box"></div>
        <div id="box8" class="box"></div>
        <div id="box9" class="box"></div>
        <div id="box10" class="box"></div>
        <div id="box11" class="box"></div>
        <div id="box12" class="box"></div>
        <div id="box13" class="box"></div>
        <div id="box14" class="box"></div>
        <div id="box15" class="box"></div>
        <div id="box16" class="box"></div>
        <div id="box17" class="box"></div>
        <div id="box18" class="box"></div>
        <div id="box19" class="box"></div>
        <div id="box20" class="box"></div>
        <div id="box21" class="box"></div>
        <div id="box22" class="box"></div>
        <div id="box23" class="box"></div>
        <div id="box24" class="box"></div>
        <div id="box25" class="box"></div>
        <div id="box26" class="box"></div>
        <div id="box27" class="box"></div>
        <div id="box28" class="box"></div>
        <div id="box29" class="box"></div>
    </div>

</body>

<script>

    const bound = document.getElementById("bound")
    const boundStyle = getComputedStyle(bound)
    
    const boundX = parseFloat(boundStyle.width)
    const boundY = parseFloat(boundStyle.height)
    
    const dt = 1
    var time = 0
    
    function getPN(){

        var Temp = Math.random()
        if(Temp>0.5) return +1
        if(Temp<=0.5) return -1
    }

    function initialV(){
        var result = (0.4 + Math.random())*1.5*getPN()
        return result
    }


    var num = 29
    var ball = []   
    var state = []
    
    for(i=1 ; i<=num; i++){
        ball[i]={}
        ball[i].element=document.getElementById("box" + i)
        ball[i].style = getComputedStyle(document.getElementById("box" + i))
        ball[i].x = boundX / 2
        ball[i].y = boundY / 2
        ball[i].vx = initialV()
        ball[i].vy = initialV()     
        ball[i].r = parseFloat(ball[i].style.width) / 2       
        
    }   

    for(i=1 ; i<=num; i++){
        state[i]=[]
        for(j=i ; j<=num; j++){
            state[i][j] = false
        }
    }


    function getPN(){

        var Temp = Math.random()
        if(Temp>0.5) return +1
        if(Temp<=0.5) return -1

    }

        // ball[1].x = 100
        // ball[1].y = 250
        // ball[1].vx = 0
        // ball[1].vy = 0   

        // ball[2].x = 300
        // ball[2].y = 250
        // ball[2].vx = -1
        // ball[2].vy = 0


    


    var Timer = setInterval(function(){

        time = time + dt
        for(i=1; i<=num; i++){        

            for(j=i;j<=num;j++){
                if(j===i){
                    continue
                }
                
                dBallx = ball[i].x - ball[j].x
                dBally = ball[i].y - ball[j].y



                dBall = Math.pow(dBallx,2) + Math.pow(dBally,2)

                if(dBall>Math.pow(2*ball[1].r,2)){
                    state[i][j] = true                    
                }
                
                if(state[i][j] === true && dBall <= Math.pow(2*ball[1].r,2)){
                    
                    
                    var vx1 = ball[i].vx
                    var vy1 = ball[i].vy
                    var vx2 = ball[j].vx
                    var vy2 = ball[j].vy

                    var vax = (vx1 + vx2)
                    var vay = (vy1 + vy2)
                    // console.log(ball[i].vx,ball[j].vx)

                    if((vx1*vx1+vy1*vy1)>(vx2*vx2+vy2*vy2)){
                        dBallx = ball[i].x - ball[j].x
                        dBally = ball[i].y - ball[j].y
                        a = (vax * dBallx + vay * dBally) / (dBallx * dBallx + dBally * dBally) * dBallx
                        b = (vax * dBallx + vay * dBally) / (dBallx * dBallx + dBally * dBally) * dBally

                        ball[j].vx = a
                        ball[j].vy = b
                        ball[i].vx = vax - a
                        ball[i].vy = vay - b

                        // console.log("j")
                        // console.log(ball[i].vx,ball[j].vx)

                    }

                    else if((vx1*vx1+vy1*vy1)<(vx2*vx2+vy2*vy2)){
                        dBallx = ball[i].x - ball[j].x
                        dBally = ball[i].y - ball[j].y
                        a = (vax * dBallx + vay * dBally) / (dBallx * dBallx + dBally * dBally) * dBallx
                        b = (vax * dBallx + vay * dBally) / (dBallx * dBallx + dBally * dBally) * dBally

                        ball[i].vx = a
                        ball[i].vy = b
                        ball[j].vx = vax - a
                        ball[j].vy = vay - b

                        // console.log("i")
                        // console.log(ball[i].vx,ball[j].vx)
                    }


                       
                    
                    state[i][j] = false
                }
            }    
            // console.log(state)

            if(ball[i].x>=boundX | ball[i].x<=0){
                ball[i].vx = -ball[i].vx
            }
            if(ball[i].y>=boundY | ball[i].y<=0){
                ball[i].vy = -ball[i].vy
            }

            ball[i].x = ball[i].x + ball[i].vx * dt
            ball[i].y = ball[i].y + ball[i].vy * dt
            ball[i].element.style.transform = "translate(" + ball[i].x + "px, " + ball[i].y + "px)"
                    
        }
        
    },dt)
    



</script>    

</html>
